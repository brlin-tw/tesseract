name: tesseract
version: git
summary: open source optical character recognition engine
description: |
  Tesseract has unicode (UTF-8) support, and can recognize more than 100
  languages "out of the box". It can be trained to recognize other languages.
  Tesseract supports various output formats: plain-text, hocr(html), pdf.

  If you want to access the files under /media/* or /run/media/* you'll have
  to connect the snap to the `core` snap's `removable-media` interface:

      $ sudo snap connect tesseract:removable-media

grade: stable # must be 'stable' to release into candidate/stable channels
confinement: strict
base: core22

apps:
  tesseract:
    command: usr/local/bin/tesseract
    environment:
      TESSDATA_PREFIX: $SNAP_USER_COMMON
    plugs:
      - home
      - removable-media

parts:
  tesseract:
    source: .
    plugin: autotools
    build-packages:
      - pkg-config
      - libpng-dev
      - libjpeg-dev
      - libtiff-dev
      - zlib1g-dev
    stage-packages:
      - libgomp1
      - libtiff5
      - zlib1g
    after: [leptonica]
    autotools-configure-parameters:
      # Disable unused features to reduce snap size and built time
      - --disable-dependency-tracking
      - --disable-doc
      - --disable-static
      - --disable-training
    prime:
      - -usr/local/include
      - -usr/local/lib/pkgconfig
      - -usr/share/lintian
      - -usr/share/man
  leptonica:
    source: https://github.com/DanBloomberg/leptonica.git
    source-tag: 1.84.1
    source-depth: 1
    plugin: autotools
    build-packages:
      - libjpeg-dev
      - libopenjp2-7-dev
      - libpng-dev
      - libtiff-dev
      - libwebp-dev
      - pkg-config
    stage-packages:
      - libjbig0
      - libjpeg-turbo8
      - libopenjp2-7
      - libpng16-16
      - libtiff5
      - libwebp7
      - libwebpmux3
    autotools-configure-parameters:
      # Reduce part build time
      - --disable-programs
      - --disable-static
      - --disable-dependency-tracking

      # Ensure features are built
      - --with-libpng
      - --with-jpeg
      - --with-libtiff
      - --with-libwebp
      - --with-libopenjpeg
    prime:
      - usr/lib/$CRAFT_ARCH_TRIPLET/*.so*
      - usr/local/lib/*.so*
      - usr/share/doc/*/copyright*
